---
name: log-checker
description: Анализ системных логов и состояния серверов Linux через SSH. Используй этот навык, когда нужно проверить здоровье сервера, найти ошибки в журналах (journalctl, auth.log, dmesg), проверить дисковое пространство или выполнить автоматическую очистку ZFS.
---

# Анализ логов серверов (log-checker)

Этот навык позволяет использовать утилиту `fast-log-check` для быстрого сбора и анализа проблем на серверах.

## Как использовать

Для анализа одного или нескольких серверов выполни команду:

```bash
python run.py <hostname> [options]
```

### Основные параметры:

- `<hostnames>`: Один или несколько хостов через пробел. Поддерживается формат `user@host`.
- `--ai-output`: **Обязательный флаг** для получения структурированного JSON, предназначенного для Claude. При использовании этого флага HTML-отчеты не генерируются.
- `--ai-format {compact,standard,full}`: Формат JSON вывода.
  - `full` (рекомендуется): Максимальная детализация с записями логов.
  - `standard`: Сводка проблем без детальных логов.
  - `compact`: Минимальный JSON для экономии токенов.
- `--period <hours>`: Глубина анализа в часах (по умолчанию 24).
- `--min-severity {critical,warning,info}`: Минимальный уровень важности событий для включения в отчет (по умолчанию `warning`).

### Параметры подключения:

- `--ssh-user <user>`: Пользователь для подключения (по умолчанию `root`).
- `--ssh-timeout <seconds>`: Таймаут подключения (по умолчанию 30).
- `--ssh-config <path>`: Путь к кастомному SSH конфигу.
- `--use-ssh-config`: Использовать список всех хостов, найденных в SSH конфигурации.
- `--ask-password`: Интерактивный запрос пароля (используй, если ключи не настроены).

### Параметры источников и вывода:

- `--file <path>`: Путь к текстовому файлу со списком серверов (по одному на строку).
- `--parallel <count>`: Количество одновременно проверяемых серверов (по умолчанию 4).
- `--cleanup-threshold <percent>`: Порог заполнения ZFS пулов (в %), при превышении которого будет запущена автоматическая очистка старых снимков (snapshots).
- `--json`: Дополнительно сохранять отчет в формате JSON (рядом с HTML).
- `--output <path>`: Путь для сохранения HTML-отчета (по умолчанию в папку `reports/`).

## Примеры команд

1.  **Полный анализ конкретного сервера:**
    `python run.py server1.example.com --ai-output --ai-format full`

2.  **Быстрая проверка группы серверов за последние 2 дня:**
    `python run.py srv1 srv2 srv3 --period 48 --ai-output --ai-format standard`

3.  **Проверка всех серверов из файла с автоочисткой ZFS (если заполнено > 85%):**
    `python run.py --file servers.txt --cleanup-threshold 85 --ai-output --ai-format full`

4.  **Анализ всех хостов из ~/.ssh/config:**
    `python run.py --use-ssh-config --ai-output`

## Интерпретация вывода (AI-output)

Утилита возвращает JSON со структурой:

- `summary`: Статистика ошибок, предупреждений и доступности.
- `critical_issues`: Список наиболее критичных проблем.
- `issues_by_category`: Группировка по категориям (`storage`, `cluster`, `kernel`, `authentication`, `services`, `network`, `virtualization`, `replication`).
- `servers`: Системная информация (uptime, load average) и статус каждого сервера.
- `detailed_logs`: (только в `full`) Сгруппированные записи из логов.

## Рекомендации

1.  **Начинай с `summary`** для оценки общего состояния инфраструктуры.
2.  **Изучай `critical_issues`** для поиска блокирующих проблем (Disk Full, Kernel Panic).
3.  **Используй `cleanup-threshold`** осторожно, если планируешь очистку снимков ZFS.
4.  Если данных мало, повтори запрос с `--period` (например, `--period 168` для недели) или измени `--min-severity info`.
