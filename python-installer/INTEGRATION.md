# Автоматическая установка Python

## Обзор

Проект включает скрипты для автоматической установки Python, если он не найден в системе. Это упрощает процесс установки для пользователей, у которых Python не установлен.

## Файлы

- **[install-python.bat](../install-python.bat)** - скрипт автоустановки Python для Windows (CMD/Batch)
- **[install-python.ps1](../install-python.ps1)** - скрипт автоустановки Python для Windows (PowerShell)

## Как это работает

### Автоматический запуск

При запуске основных скриптов установки (`install.bat` или `install.ps1`), если Python не найден:

1. Пользователю предлагается выбор:
   - **[1] Автоматическая установка** (рекомендуется)
   - **[2] Ручная установка** (инструкции)

2. При выборе автоматической установки:
   - Запрашиваются права администратора (UAC prompt)
   - Определяется архитектура системы (x64/x86/ARM64)
   - Пользователю показываются параметры установки
   - Запрашивается подтверждение

3. Установка выполняется одним из способов:
   - **Через winget** (если доступен) - быстрее и проще
   - **Через официальный установщик** - скачивание с python.org

### Процесс установки

#### Шаг 1: Проверка прав администратора
Скрипт проверяет наличие прав администратора. Если их нет, запускается UAC prompt для повышения прав.

#### Шаг 2: Определение архитектуры
Автоматически определяется архитектура процессора:
- **x64** (AMD64) - 64-битная
- **x86** - 32-битная
- **ARM64** - ARM 64-битная

#### Шаг 3: Определение версии
Выбирается последняя стабильная версия Python:
- **Текущая: Python 3.13.1**
- **Минимально поддерживаемая: Python 3.11+**

#### Шаг 4: Запрос подтверждения
Пользователю показываются параметры установки:
```
Python не найден в системе.

Предлагается установить Python 3.13.1 (x64)

Параметры установки:
  • Версия: Python 3.13.1
  • Установка: Для всех пользователей
  • PATH: Будет добавлен автоматически
  • Размер: ~30-40 МБ

Установить Python? (Y/N):
```

#### Шаг 5: Попытка установки через winget
Если `winget` доступен в системе:
```bash
winget install Python.Python.3.13 --silent --accept-package-agreements --accept-source-agreements
```

**Преимущества winget:**
- ✅ Быстрая установка
- ✅ Не требуется скачивание отдельного файла
- ✅ Автоматические обновления через Windows Store

**Недостатки:**
- ❌ Доступен только на Windows 10 (1809+) / Windows 11
- ❌ Может отсутствовать на старых системах

#### Шаг 6: Альтернативный метод (скачивание установщика)
Если winget недоступен или завершился с ошибкой:

1. **Скачивание установщика** с официального сайта:
   - URL: `https://www.python.org/ftp/python/3.13.1/python-3.13.1-{arch}.exe`
   - Сохранение в `%TEMP%\python-installer.exe`
   - Использование TLS 1.2 для безопасности

2. **Установка с параметрами:**
   ```
   python-installer.exe /quiet InstallAllUsers=1 PrependPath=1 Include_test=0 Include_launcher=1 SimpleInstall=1
   ```

**Параметры установки:**
- `/quiet` - тихая установка без GUI
- `InstallAllUsers=1` - установка для всех пользователей
- `PrependPath=1` - добавление Python в PATH
- `Include_test=0` - не устанавливать тестовые модули (экономия места)
- `Include_launcher=1` - установить Python Launcher
- `SimpleInstall=1` - упрощенная установка

#### Шаг 7: Проверка установки
После установки выполняется проверка:
```bash
python --version
python -m pip --version
```

Если Python не доступен сразу, скрипт:
- Обновляет переменные окружения из реестра
- Перезагружает PATH для текущей сессии
- Предупреждает о необходимости перезапуска терминала, если нужно

### Откат при ошибке

Если установка завершается с ошибкой:

1. **Выполняется откат:**
   - Запуск деинсталлятора: `python-installer.exe /uninstall /quiet`
   - Удаление временных файлов
   - Очистка частично установленных компонентов

2. **Пользователю предлагается:**
   - Попробовать установку вручную
   - Ссылка на официальный сайт
   - Инструкции по установке

## Параметры установки Python

### Версия Python
- **По умолчанию:** Python 3.13.1
- **Минимальная поддерживаемая:** Python 3.11+
- **Рекомендуемая:** Последняя стабильная версия 3.13.x

### Место установки

**Для всех пользователей (по умолчанию):**
```
C:\Program Files\Python313\
```

**Для текущего пользователя (альтернатива):**
```
C:\Users\<username>\AppData\Local\Programs\Python\Python313\
```

### Что устанавливается

Базовая установка включает:
- ✅ Python interpreter
- ✅ pip (менеджер пакетов)
- ✅ Python Launcher (py.exe)
- ✅ Стандартная библиотека
- ✅ IDLE (опционально)
- ❌ Тесты (исключены для экономии места)
- ❌ Документация (можно скачать отдельно)

## Ручной запуск скриптов

### Batch версия (install-python.bat)

```cmd
# Запуск с правами администратора
install-python.bat

# Или через контекстное меню:
# ПКМ → Запустить от имени администратора
```

### PowerShell версия (install-python.ps1)

```powershell
# Запуск с правами администратора
powershell -ExecutionPolicy Bypass -File install-python.ps1

# Или внутри PowerShell с правами администратора:
.\install-python.ps1
```

## Требования

### Системные требования
- **ОС:** Windows 10 (1809+), Windows 11, Windows Server 2019+
- **Архитектура:** x86, x64, ARM64
- **Права:** Администратор (для установки для всех пользователей)
- **Свободное место:** ~200 МБ (Python + зависимости)
- **Интернет:** Требуется для скачивания установщика

### Сетевые требования
- **Доступ к:** `https://www.python.org` (для скачивания установщика)
- **Протокол:** HTTPS (TLS 1.2+)
- **Порты:** 443 (HTTPS)

## Устранение неполадок

### Python не обнаружен после установки

**Причина:** PATH не обновлен в текущей сессии

**Решение:**
1. Закройте командную строку / PowerShell
2. Откройте новое окно
3. Проверьте: `python --version`

### Ошибка "Требуются права администратора"

**Причина:** Скрипт запущен без прав администратора

**Решение:**
1. Закройте скрипт
2. ПКМ на скрипте → "Запустить от имени администратора"
3. Подтвердите UAC prompt

### Ошибка скачивания установщика

**Причина:** Проблемы с сетью или блокировка firewall

**Решение:**
1. Проверьте подключение к интернету
2. Проверьте настройки firewall
3. Попробуйте использовать VPN
4. Установите Python вручную с флешки

### winget не найден

**Причина:** Windows Package Manager не установлен

**Решение:**
- Скрипт автоматически перейдет к альтернативному методу
- Или установите winget вручную:
  ```powershell
  # Установка winget (Windows 10)
  # Скачайте из Microsoft Store: "App Installer"
  ```

### Установка завершается с ошибкой

**Причина:** Конфликт с существующей установкой или поврежденный установщик

**Решение:**
1. Удалите старые версии Python через "Установка и удаление программ"
2. Очистите `%TEMP%` от старых установщиков
3. Перезагрузите компьютер
4. Запустите скрипт заново
5. Если не помогает - установите вручную

### Антивирус блокирует установку

**Причина:** Ложное срабатывание антивируса

**Решение:**
1. Временно отключите антивирус
2. Добавьте исключение для `python-installer.exe`
3. Проверьте цифровую подпись установщика
4. Скачайте установщик вручную и проверьте хеш-сумму

## Безопасность

### Проверка источника
- ✅ Установщик скачивается только с официального сайта `python.org`
- ✅ Используется HTTPS (TLS 1.2+) для безопасного соединения
- ✅ URL установщика проверяется на корректность
- ❌ Цифровая подпись не проверяется автоматически (можно добавить)

### Параметры безопасности
- Установщик запускается с флагом `/quiet` (без интерактивного режима)
- Временные файлы удаляются после установки
- Установка выполняется только после подтверждения пользователя

### Рекомендации
1. Запускайте скрипты только из доверенных источников
2. Проверяйте содержимое скриптов перед запуском
3. Используйте антивирус для проверки скачанных файлов
4. Не отключайте UAC для обхода запроса прав

## Ограничения

### Текущие ограничения
- ❌ Не поддерживается установка конкретной версии (только 3.13.1)
- ❌ Не поддерживается выбор компонентов для установки
- ❌ Не поддерживается установка в пользовательский каталог
- ❌ Не проверяется цифровая подпись установщика
- ❌ Не поддерживается установка нескольких версий Python

### Планируемые улучшения
- ✅ Поддержка выбора версии Python (3.11, 3.12, 3.13)
- ✅ Проверка цифровой подписи установщика
- ✅ Выбор места установки
- ✅ Установка дополнительных компонентов (IDLE, документация)
- ✅ Поддержка offline установки (с локального файла)

## Интеграция с основными скриптами

Скрипты автоустановки интегрированы в основные скрипты установки:

### install.bat
```batch
python --version > nul 2>&1
if errorlevel 1 (
    echo Python не найден

    # Предложение автоустановки
    set /p "INSTALL_CHOICE=Выберите вариант (1 или 2): "

    if "!INSTALL_CHOICE!"=="1" (
        set "CALLED_FROM_INSTALL=1"
        call "%~dp0install-python.bat"
    )
)
```

### install.ps1
```powershell
try {
    $pythonVersion = & python --version 2>&1
    # ...
}
catch {
    Write-Host "Python не найден"

    # Предложение автоустановки
    $installChoice = Read-Host "Выберите вариант (1 или 2)"

    if ($installChoice -eq "1") {
        $env:CALLED_FROM_INSTALL = "1"
        & "$PSScriptRoot\install-python.ps1"
    }
}
```

## Примеры использования

### Полная автоматическая установка
```cmd
# 1. Запуск основного скрипта
install.bat

# 2. При отсутствии Python выбрать [1]
# 3. Подтвердить установку (Y)
# 4. Дождаться завершения
# 5. Продолжить установку зависимостей
```

### Только установка Python (без зависимостей)
```cmd
# Запуск напрямую
install-python.bat

# Или через PowerShell
powershell -ExecutionPolicy Bypass -File install-python.ps1
```

### Тихая установка (для CI/CD)
```cmd
# Через переменную окружения (будущая функция)
set PYTHON_AUTO_INSTALL=1
install.bat
```

## Дополнительная информация

### Официальная документация Python
- **Установка:** https://docs.python.org/3/using/windows.html
- **Параметры установщика:** https://docs.python.org/3/using/windows.html#installing-without-ui

### winget
- **Документация:** https://learn.microsoft.com/en-us/windows/package-manager/winget/

### Поддержка
- **Issues:** https://github.com/your-org/fastlogcheck/issues
- **Обсуждения:** https://github.com/your-org/fastlogcheck/discussions

---

**Последнее обновление:** 2025-12-02
